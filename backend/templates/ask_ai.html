{% extends "layout.html" %}
{% block content %}

<hr style="margin: 2rem 0; border: 1px solid #444;">

<h2>💡 Ask AI for a Custom Cocktail Recommendation</h2>
<form id="ai-form">
  <input type="text" id="ai-prompt" placeholder="e.g. I want something refreshing with vodka" required />
  <button type="submit">Ask AI 🍹</button>
</form>

<pre id="ai-response" style="white-space: pre-wrap; background: #2a2540; padding: 1rem; border-radius: 8px; margin-top: 1rem; color: #7fdbda;"></pre>

<script>
  document.getElementById("ai-form").addEventListener("submit", function(e) {
    e.preventDefault();
    const prompt = document.getElementById("ai-prompt").value;
    const responseBox = document.getElementById("ai-response");

    responseBox.textContent = "Asking the bartender... 🍸";

    fetch("/api/ai/ask", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ prompt })
    })
      .then(res => res.json())
      .then(data => {
        responseBox.textContent = data.recommendation || "No suggestion.";
        if (data.user_logged) {
            responseBox.innerHTML += `<br><br><strong id="save">Would you like to save this suggestion?</strong>`;
            const saveButton = document.createElement("button");
            saveButton.id = "saveButton";
            saveButton.textContent = "Save to Favorites";
            saveButton.addEventListener("click", () => {
                fetch("/api/favorites/", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ info: data.recommendation })
                })
                .then(() => {
                responseBox.innerHTML += "<br>Saved to favorites!";
                document.getElementById("save").remove()
                document.getElementById("saveButton").remove()
                });
            });
            responseBox.appendChild(saveButton);
        }
      })
      .catch(() => {
        responseBox.textContent = "Something went wrong while talking to the AI bartender.";
      });
  });
</script>

{% endblock %}